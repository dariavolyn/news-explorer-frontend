{"ast":null,"code":"import _toConsumableArray from\"/Users/dashon/Desktop/react-around-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/dashon/Desktop/react-around-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/dashon/Desktop/react-around-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{Redirect,Route,Switch,useHistory}from'react-router-dom';import AddPlacePopup from'./AddPlacePopup.js';import api from'../utils/api.js';import auth from'../utils/auth.js';import{CurrentUserContext}from'../contexts/CurrentUserContext.js';import EditAvatarPopup from'./EditAvatarPopup.js';import EditProfilePopup from'./EditProfilePopup.js';import Footer from'./Footer.js';import Header from'./Header.js';import ImagePopup from'./ImagePopup.js';import InfoToolTip from'./InfoToolTip.js';import Login from'./Login.js';import Main from'./Main.js';import{ProtectedRoute}from'./ProtectedRoute.js';import Register from'./Register.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),addPlacePopupOpen=_useState2[0],setIsAddPlaceOpen=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),cards=_useState4[0],setCards=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),currentUser=_useState6[0],setCurrentUser=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),editAvatarPopupOpen=_useState8[0],setIsEditAvatarOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),editProfilePopupOpen=_useState10[0],setIsEditProfileOpen=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),infoToolTipOpen=_useState12[0],setIsInfoToolTipOpen=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),selectedCard=_useState14[0],setSelectedCard=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),loggedIn=_useState16[0],setLoggedIn=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),register=_useState18[0],setRegister=_useState18[1];var _useState19=useState({}),_useState20=_slicedToArray(_useState19,2),userData=_useState20[0],setUserData=_useState20[1];var history=useHistory();// currentUser\nReact.useEffect(function(){api.getUserInfo().then(function(res){setCurrentUser(_objectSpread(_objectSpread({},currentUser),{},{name:res.name,about:res.about,avatar:res.avatar,_id:res._id}));}).catch(function(err){console.log(err);});// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);// registering user\nfunction handleRegister(email,password){auth.registerUser(email,password).then(function(res){handleInfoToolTipOpen();if(res){setRegister(true);history.push('/signin');}else{return;}}).catch(function(e){console.log(e);});}// checking token\nuseEffect(function(){var token=localStorage.getItem('token');if(token){auth.getContent(token).then(function(res){setLoggedIn(true);setUserData(res.data);history.push('/main');}).catch(function(e){return console.log(e);});}},[]);// logging in\nfunction handleLogin(email,password){auth.authorizeUser(email,password).then(function(res){setUserData(email);if(res.token){setLoggedIn(true);history.push('/main');}}).catch(function(err){return console.log(err);});}// logging out\nfunction handleLogOut(){setUserData({});setLoggedIn(false);}// cards\nuseEffect(function(){api.getCardsList().then(function(res){setCards(res);}).catch(function(err){console.log(err);});},[]);function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});if(!isLiked){api.addLike(card._id).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}else{api.deleteLike(card._id).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}}function handleCardDelete(card){api.removeCard(card._id).then(function(){var updatedList=cards.filter(function(c){return c._id!==card._id;});setCards(updatedList);}).catch(function(err){console.log(err);});}//popups \nfunction handleAddPlaceOpen(){setIsAddPlaceOpen(true);}function handleCardClick(card){setSelectedCard(card);}function handleEditAvatarOpen(){setIsEditAvatarOpen(true);}function handleEditProfileOpen(){setIsEditProfileOpen(true);}function handleInfoToolTipOpen(){setIsInfoToolTipOpen(true);}function closeAllPopups(){setIsAddPlaceOpen(false);setIsEditAvatarOpen(false);setIsEditProfileOpen(false);setIsInfoToolTipOpen(false);setSelectedCard(null);}function handleUpdateUser(newUser){api.setUserInfo({name:newUser.name,about:newUser.about}).then(function(res){setCurrentUser(_objectSpread(_objectSpread({},currentUser),{},{name:newUser.name,about:newUser.about}));}).then(closeAllPopups).catch(function(err){console.log(err);});}function handleUpdateAvatar(newUser){api.setUserPic({avatar:newUser.avatar}).then(function(){setCurrentUser(_objectSpread(_objectSpread({},currentUser),{},{avatar:newUser.avatar}));}).then(closeAllPopups).catch(function(err){console.log(err);});}function handleAddPlaceSubmit(card){api.addCard({name:card.name,link:card.link}).then(function(card){setCards([card].concat(_toConsumableArray(cards)));}).then(closeAllPopups).catch(function(err){console.log(err);});}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,userData:userData,onLogOut:handleLogOut}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:addPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:editAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:editProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(InfoToolTip,{isOpen:infoToolTipOpen,onClose:closeAllPopups,isRegistered:register}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/main\",loggedIn:loggedIn,component:Main,cards:cards,handleCardClick:handleCardClick,onAddPlace:handleAddPlaceOpen,onCardDelete:handleCardDelete,onCardLike:handleCardLike,onClose:closeAllPopups,onEditAvatar:handleEditAvatarOpen,onEditProfile:handleEditProfileOpen}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{onSubmit:handleRegister})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{onSubmit:handleLogin})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/main\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"})})]}),loggedIn&&/*#__PURE__*/_jsx(Footer,{})]})});}export default App;","map":{"version":3,"sources":["/Users/dashon/Desktop/react-around-api-full/frontend/src/components/App.js"],"names":["React","useState","useEffect","Redirect","Route","Switch","useHistory","AddPlacePopup","api","auth","CurrentUserContext","EditAvatarPopup","EditProfilePopup","Footer","Header","ImagePopup","InfoToolTip","Login","Main","ProtectedRoute","Register","App","props","addPlacePopupOpen","setIsAddPlaceOpen","cards","setCards","currentUser","setCurrentUser","editAvatarPopupOpen","setIsEditAvatarOpen","editProfilePopupOpen","setIsEditProfileOpen","infoToolTipOpen","setIsInfoToolTipOpen","selectedCard","setSelectedCard","loggedIn","setLoggedIn","register","setRegister","userData","setUserData","history","getUserInfo","then","res","name","about","avatar","_id","catch","err","console","log","handleRegister","email","password","registerUser","handleInfoToolTipOpen","push","e","token","localStorage","getItem","getContent","data","handleLogin","authorizeUser","handleLogOut","getCardsList","handleCardLike","card","isLiked","likes","some","i","addLike","newCard","state","map","c","deleteLike","handleCardDelete","removeCard","updatedList","filter","handleAddPlaceOpen","handleCardClick","handleEditAvatarOpen","handleEditProfileOpen","closeAllPopups","handleUpdateUser","newUser","setUserInfo","handleUpdateAvatar","setUserPic","handleAddPlaceSubmit","addCard","link"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Redirect, Route, Switch, useHistory } from 'react-router-dom';\n\nimport AddPlacePopup from './AddPlacePopup.js';\nimport api from '../utils/api.js';\nimport auth from '../utils/auth.js';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport Footer from './Footer.js';\nimport Header from './Header.js';\nimport ImagePopup from './ImagePopup.js';\nimport InfoToolTip from './InfoToolTip.js';\nimport Login from './Login.js';\nimport Main from './Main.js';\nimport { ProtectedRoute } from './ProtectedRoute.js';\nimport Register from './Register.js';\n\n\nfunction App(props) {\n    const [addPlacePopupOpen, setIsAddPlaceOpen] = useState(false);\n    const [cards, setCards] = useState([]);\n    const [currentUser, setCurrentUser] = useState({});\n    const [editAvatarPopupOpen, setIsEditAvatarOpen] = useState(false);\n    const [editProfilePopupOpen, setIsEditProfileOpen] = useState(false);\n    const [infoToolTipOpen, setIsInfoToolTipOpen] = useState(false);\n    const [selectedCard, setSelectedCard] = useState(null);\n    const [loggedIn, setLoggedIn] = useState(false);\n    const [register, setRegister] = useState(false);\n    const [userData, setUserData] = useState({});\n    const history = useHistory();\n\n    // currentUser\n    React.useEffect(() => {\n        api.getUserInfo()\n            .then((res) => {\n                setCurrentUser({\n                    ...currentUser,\n                    name: res.name,\n                    about: res.about,\n                    avatar: res.avatar,\n                    _id: res._id\n                })\n            })\n            .catch((err) => {\n                console.log(err);\n            })\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [])\n\n\n    // registering user\n    function handleRegister(email, password) {\n        auth.registerUser(email, password)\n            .then((res) => {\n                handleInfoToolTipOpen();\n                if (res) {\n                    setRegister(true);\n                    history.push('/signin');\n                }\n                else {\n                    return\n                }\n            }).catch(e => {\n                console.log(e);\n            })\n    }\n\n    // checking token\n    useEffect(() => {\n        const token = localStorage.getItem('token');\n        if (token) {\n            auth.getContent(token)\n                .then((res) => {\n                    setLoggedIn(true);\n                    setUserData(res.data);\n                    history.push('/main');\n                }\n                )\n                .catch((e) => console.log(e))\n        }\n    }, [])\n\n    // logging in\n    function handleLogin(email, password) {\n        auth.authorizeUser(email, password)\n            .then((res) => {\n                setUserData(email);\n                if (res.token) {\n                    setLoggedIn(true);\n                    history.push('/main');\n                }\n            })\n            .catch(err => console.log(err));\n    }\n\n    // logging out\n    function handleLogOut() {\n        setUserData({});\n        setLoggedIn(false);\n    }\n\n\n    // cards\n    useEffect(() => {\n        api.getCardsList()\n            .then((res) => {\n                setCards(res)\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n    }, []);\n\n    function handleCardLike(card) {\n        const isLiked = card.likes.some(i => i._id === currentUser._id);\n\n        if (!isLiked) {\n            api.addLike(card._id)\n                .then((newCard) => {\n                    setCards((state) => state.map((c) => c._id === card._id ? newCard : c))\n                })\n                .catch((err) => {\n                    console.log(err);\n                })\n        }\n        else {\n            api.deleteLike(card._id)\n                .then((newCard) => {\n                    setCards((state) => state.map((c) => c._id === card._id ? newCard : c))\n                })\n                .catch((err) => {\n                    console.log(err);\n                })\n        }\n    }\n\n    function handleCardDelete(card) {\n        api\n            .removeCard(card._id)\n            .then(() => {\n                const updatedList = cards.filter((c) => c._id !== card._id);\n                setCards(updatedList);\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n\n    }\n\n    //popups \n    function handleAddPlaceOpen() {\n        setIsAddPlaceOpen(true);\n    }\n\n    function handleCardClick(card) {\n        setSelectedCard(card)\n    }\n\n    function handleEditAvatarOpen() {\n        setIsEditAvatarOpen(true);\n    }\n\n    function handleEditProfileOpen() {\n        setIsEditProfileOpen(true);\n    }\n\n    function handleInfoToolTipOpen() {\n        setIsInfoToolTipOpen(true);\n    }\n\n    function closeAllPopups() {\n        setIsAddPlaceOpen(false);\n        setIsEditAvatarOpen(false);\n        setIsEditProfileOpen(false);\n        setIsInfoToolTipOpen(false);\n        setSelectedCard(null);\n    }\n\n    function handleUpdateUser(newUser) {\n        api.setUserInfo({ name: newUser.name, about: newUser.about })\n            .then((res) => {\n                setCurrentUser({\n                    ...currentUser,\n                    name: newUser.name,\n                    about: newUser.about\n                })\n            })\n            .then(closeAllPopups)\n            .catch((err) => {\n                console.log(err);\n            })\n    }\n\n    function handleUpdateAvatar(newUser) {\n        api.setUserPic({ avatar: newUser.avatar })\n            .then(() => {\n                setCurrentUser({\n                    ...currentUser,\n                    avatar: newUser.avatar\n                })\n            })\n            .then(closeAllPopups)\n            .catch((err) => {\n                console.log(err);\n            })\n    }\n\n    function handleAddPlaceSubmit(card) {\n        api.addCard({ name: card.name, link: card.link })\n            .then((card) => {\n                setCards([card, ...cards])\n            })\n\n            .then(closeAllPopups)\n            .catch((err) => {\n                console.log(err);\n            })\n    }\n\n    return (\n\n        <CurrentUserContext.Provider value={currentUser}>\n            <div className=\"App\">\n                <Header loggedIn={loggedIn} userData={userData} onLogOut={handleLogOut} />\n\n                <ImagePopup\n                    card={selectedCard}\n                    onClose={closeAllPopups}\n                />\n\n                <AddPlacePopup isOpen={addPlacePopupOpen} onClose={closeAllPopups} onAddPlace={handleAddPlaceSubmit} />\n\n                <EditAvatarPopup isOpen={editAvatarPopupOpen} onClose={closeAllPopups} onUpdateAvatar={handleUpdateAvatar} />\n\n                <EditProfilePopup isOpen={editProfilePopupOpen} onClose={closeAllPopups} onUpdateUser={handleUpdateUser} />\n\n                <InfoToolTip isOpen={infoToolTipOpen} onClose={closeAllPopups} isRegistered={register} />\n\n                <Switch>\n\n                    <ProtectedRoute exact path=\"/main\"\n                        loggedIn={loggedIn}\n                        component={Main}\n                        cards={cards}\n                        handleCardClick={handleCardClick}\n                        onAddPlace={handleAddPlaceOpen}\n                        onCardDelete={handleCardDelete}\n                        onCardLike={handleCardLike}\n                        onClose={closeAllPopups}\n                        onEditAvatar={handleEditAvatarOpen}\n                        onEditProfile={handleEditProfileOpen}>\n                    </ProtectedRoute>\n\n                    <Route exact path=\"/signup\">\n                        <Register onSubmit={handleRegister} />\n                    </Route>\n\n                    <Route exact path=\"/signin\">\n                        <Login onSubmit={handleLogin} />\n                    </Route>\n\n                    <Route exact path=\"/\">\n                        {loggedIn\n                            ? <Redirect to=\"/main\" />\n                            : <Redirect to=\"/signin\" />}\n                    </Route>\n\n                </Switch>\n                {loggedIn && <Footer />}\n            </div>\n        </CurrentUserContext.Provider>\n\n    )\n}\n\nexport default App"]},"metadata":{},"sourceType":"module"}