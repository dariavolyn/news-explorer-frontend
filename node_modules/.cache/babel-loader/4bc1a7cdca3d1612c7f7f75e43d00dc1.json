{"ast":null,"code":"var _jsxFileName = \"/Users/dashon/Desktop/news-explorer-frontend/src/components/App/App.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { Route, Switch, useHistory } from 'react-router-dom';\nimport Authentication from '../Authentication/Authentication.js';\nimport { CurrentUserContext } from '../../contexts/CurrentUserContext.js';\nimport Header from '../Header/Header.js';\nimport Footer from '../Footer/Footer.js';\nimport Main from '../Main/Main.js';\nimport Register from '../Register/Register.js';\nimport SavedNews from '../SavedNews/SavedNews.js';\nimport SuccessPopup from '../SuccessPopup/SuccessPopup.js';\nimport newsApi from '../../utils/NewsApi.js';\nimport mainApi from '../../utils/MainApi.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [cards, setCards] = useState([]);\n  const [cardOwner, setCardOwner] = useState({});\n  const [savedCards, setSavedCards] = useState([]);\n  const [currentUser, setCurrentUser] = useState({});\n  const [isAuthOpen, setAuthOpen] = useState(false);\n  const [isCardSaved, setCardSaved] = useState(false);\n  const [isLoggedIn, setLoggedIn] = useState(false);\n  const [isRegisterOpen, setRegisterOpen] = useState(false);\n  const [isNavMobileOpen, setNavMobileOpen] = useState(false);\n  const [isNothingFoundOpen, setIsNothingFoundOpen] = useState(false);\n  const [isSuccessPopupOpen, setSuccessPopupOpen] = useState(false);\n  const [isPreloaderOpen, setIsPreloaderOpen] = useState(false);\n  const history = useHistory(); // global state for close on Esc\n\n  useEffect(() => {\n    const close = e => {\n      if (e.keyCode === 27) {\n        closeAllPopups();\n      }\n    };\n\n    window.addEventListener('keydown', close);\n    return () => window.removeEventListener('keydown', close);\n  }); // checking token\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n\n    if (token) {\n      mainApi.getContent(token).then(() => {\n        setLoggedIn(true);\n      }).catch(e => console.log(e));\n    }\n  }, []); // getting user info\n\n  React.useEffect(() => {\n    const token = localStorage.getItem('token');\n\n    if (token) {\n      mainApi.getUserInfo(token).then(res => {\n        setCurrentUser({\n          username: res.user.username,\n          _id: res.user._id\n        });\n      }).catch(e => console.log(e));\n    }\n  }, []); // popup behaviour\n\n  function handleAuthOpen() {\n    setSuccessPopupOpen(false);\n    setRegisterOpen(false);\n    setAuthOpen(true);\n    history.push('/signin');\n  }\n\n  function handleRegisterOpen() {\n    setAuthOpen(false);\n    setRegisterOpen(true);\n  }\n\n  function handleNavMobileOpen() {\n    setNavMobileOpen(true);\n  }\n\n  function closeAllPopups() {\n    setSuccessPopupOpen(false);\n    setRegisterOpen(false);\n    setAuthOpen(false);\n    history.push('/');\n  }\n\n  function closeNavMobile() {\n    setNavMobileOpen(false);\n  } // user forms submit\n\n\n  function handleAuth(email, password) {\n    mainApi.authorizeUser(email, password).then(res => {\n      closeAllPopups();\n      setLoggedIn(true);\n      setCurrentUser({\n        username: res.user\n      });\n      history.push('/saved-news');\n    }).catch(e => {\n      console.log(e);\n    });\n  }\n\n  function handleRegister(email, password, username) {\n    mainApi.registerUser(email, password, username).then(() => {\n      setRegisterOpen(false);\n      setSuccessPopupOpen(true);\n    }).catch(e => console.log(e));\n  } // searching cards\n\n\n  function searchCards(search) {\n    setIsPreloaderOpen(true);\n    setIsNothingFoundOpen(false);\n    setCards([]);\n    newsApi.getCardsList(search).then(res => {\n      if (res.totalResults === 0) {\n        setIsNothingFoundOpen(true);\n      } else {\n        setCards(res);\n      }\n    }).then(() => {\n      setIsPreloaderOpen(false);\n    }).catch(e => console.log(e));\n  } // saving an article \n\n\n  function handleSaveArticle(card) {\n    const id = card.url;\n    mainApi.saveArticle(id).then(res => {\n      setCardOwner(currentUser._id);\n      setCardSaved(true);\n    }).catch(e => console.log(e));\n  } // load saved articles\n\n\n  useEffect(() => {\n    mainApi.getSavedArticles(currentUser._id).then(res => {\n      setSavedCards(res);\n    });\n  }, [isCardSaved, isLoggedIn]); // logging out\n\n  function handleSignOut() {\n    localStorage.removeItem('token');\n    setCurrentUser({});\n    setLoggedIn(false);\n    history.push('/');\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n      value: currentUser,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"app\",\n        children: [/*#__PURE__*/_jsxDEV(Switch, {\n          children: [/*#__PURE__*/_jsxDEV(Route, {\n            exact: true,\n            path: \"/saved-news\",\n            children: /*#__PURE__*/_jsxDEV(SavedNews, {\n              isLoggedIn: isLoggedIn,\n              isNavMobileOpen: isNavMobileOpen,\n              handleSignOut: handleSignOut,\n              onClose: closeNavMobile,\n              onOpen: handleNavMobileOpen,\n              page: \"saved-news\",\n              savedCards: savedCards\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 167,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/\",\n            children: [/*#__PURE__*/_jsxDEV(Header, {\n              closeNavMobile: closeNavMobile,\n              isLoggedIn: isLoggedIn,\n              isNavMobileOpen: isNavMobileOpen,\n              handleRegisterOpen: handleRegisterOpen,\n              handleSignOut: handleSignOut,\n              onAuth: handleAuthOpen,\n              onClose: closeAllPopups,\n              onOpen: handleNavMobileOpen,\n              page: \"main\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 178,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Main, {\n              cards: cards.articles,\n              cardOwner: cardOwner,\n              isLoggedIn: isLoggedIn,\n              isNothingFoundOpen: isNothingFoundOpen,\n              isPreloaderOpen: isPreloaderOpen,\n              isSaved: isCardSaved,\n              onSave: handleSaveArticle,\n              searchCards: searchCards,\n              page: \"main\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 189,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/signin\",\n          children: /*#__PURE__*/_jsxDEV(Authentication, {\n            altFormTitle: \"Sign up\",\n            altFormLink: \"/signup\",\n            openAltForm: handleRegisterOpen,\n            isOpen: isAuthOpen,\n            formSubmit: handleAuth,\n            onClose: closeAllPopups\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/signup\",\n          children: /*#__PURE__*/_jsxDEV(Register, {\n            altFormTitle: \"Sign in\",\n            altFormLink: \"/signin\",\n            openAltForm: handleAuthOpen,\n            isOpen: isRegisterOpen,\n            formSubmit: handleRegister,\n            onClose: closeAllPopups\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 214,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(SuccessPopup, {\n          isOpen: isSuccessPopupOpen,\n          openAuth: handleAuthOpen,\n          onClose: closeAllPopups\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 13\n    }, this)\n  }, void 0, false);\n}\n\n_s(App, \"m9cjASI07qom3x3lz3+TrV7/9R4=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/dashon/Desktop/news-explorer-frontend/src/components/App/App.js"],"names":["React","useEffect","useState","Route","Switch","useHistory","Authentication","CurrentUserContext","Header","Footer","Main","Register","SavedNews","SuccessPopup","newsApi","mainApi","App","cards","setCards","cardOwner","setCardOwner","savedCards","setSavedCards","currentUser","setCurrentUser","isAuthOpen","setAuthOpen","isCardSaved","setCardSaved","isLoggedIn","setLoggedIn","isRegisterOpen","setRegisterOpen","isNavMobileOpen","setNavMobileOpen","isNothingFoundOpen","setIsNothingFoundOpen","isSuccessPopupOpen","setSuccessPopupOpen","isPreloaderOpen","setIsPreloaderOpen","history","close","e","keyCode","closeAllPopups","window","addEventListener","removeEventListener","token","localStorage","getItem","getContent","then","catch","console","log","getUserInfo","res","username","user","_id","handleAuthOpen","push","handleRegisterOpen","handleNavMobileOpen","closeNavMobile","handleAuth","email","password","authorizeUser","handleRegister","registerUser","searchCards","search","getCardsList","totalResults","handleSaveArticle","card","id","url","saveArticle","getSavedArticles","handleSignOut","removeItem","articles"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SAASC,KAAT,EAAgBC,MAAhB,EAAwBC,UAAxB,QAA0C,kBAA1C;AAEA,OAAOC,cAAP,MAA2B,qCAA3B;AACA,SAASC,kBAAT,QAAmC,sCAAnC;AACA,OAAOC,MAAP,MAAmB,qBAAnB;AACA,OAAOC,MAAP,MAAmB,qBAAnB;AACA,OAAOC,IAAP,MAAiB,iBAAjB;AACA,OAAOC,QAAP,MAAqB,yBAArB;AACA,OAAOC,SAAP,MAAsB,2BAAtB;AACA,OAAOC,YAAP,MAAyB,iCAAzB;AACA,OAAOC,OAAP,MAAoB,wBAApB;AACA,OAAOC,OAAP,MAAoB,wBAApB;;;;AAGA,SAASC,GAAT,GAAe;AAAA;;AACX,QAAM,CAACC,KAAD,EAAQC,QAAR,IAAoBhB,QAAQ,CAAC,EAAD,CAAlC;AACA,QAAM,CAACiB,SAAD,EAAYC,YAAZ,IAA4BlB,QAAQ,CAAC,EAAD,CAA1C;AACA,QAAM,CAACmB,UAAD,EAAaC,aAAb,IAA8BpB,QAAQ,CAAC,EAAD,CAA5C;AACA,QAAM,CAACqB,WAAD,EAAcC,cAAd,IAAgCtB,QAAQ,CAAC,EAAD,CAA9C;AACA,QAAM,CAACuB,UAAD,EAAaC,WAAb,IAA4BxB,QAAQ,CAAC,KAAD,CAA1C;AACA,QAAM,CAACyB,WAAD,EAAcC,YAAd,IAA8B1B,QAAQ,CAAC,KAAD,CAA5C;AACA,QAAM,CAAC2B,UAAD,EAAaC,WAAb,IAA4B5B,QAAQ,CAAC,KAAD,CAA1C;AACA,QAAM,CAAC6B,cAAD,EAAiBC,eAAjB,IAAoC9B,QAAQ,CAAC,KAAD,CAAlD;AACA,QAAM,CAAC+B,eAAD,EAAkBC,gBAAlB,IAAsChC,QAAQ,CAAC,KAAD,CAApD;AACA,QAAM,CAACiC,kBAAD,EAAqBC,qBAArB,IAA8ClC,QAAQ,CAAC,KAAD,CAA5D;AACA,QAAM,CAACmC,kBAAD,EAAqBC,mBAArB,IAA4CpC,QAAQ,CAAC,KAAD,CAA1D;AACA,QAAM,CAACqC,eAAD,EAAkBC,kBAAlB,IAAwCtC,QAAQ,CAAC,KAAD,CAAtD;AACA,QAAMuC,OAAO,GAAGpC,UAAU,EAA1B,CAbW,CAeX;;AACAJ,EAAAA,SAAS,CAAC,MAAM;AACZ,UAAMyC,KAAK,GAAIC,CAAD,IAAO;AAAE,UAAIA,CAAC,CAACC,OAAF,KAAc,EAAlB,EAAsB;AAAEC,QAAAA,cAAc;AAAK;AAAE,KAApE;;AACAC,IAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmCL,KAAnC;AACA,WAAO,MAAMI,MAAM,CAACE,mBAAP,CAA2B,SAA3B,EAAsCN,KAAtC,CAAb;AACH,GAJQ,CAAT,CAhBW,CAsBX;;AACAzC,EAAAA,SAAS,CAAC,MAAM;AACZ,UAAMgD,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAd;;AACA,QAAIF,KAAJ,EAAW;AACPlC,MAAAA,OAAO,CAACqC,UAAR,CAAmBH,KAAnB,EACKI,IADL,CACU,MAAM;AACRvB,QAAAA,WAAW,CAAC,IAAD,CAAX;AACH,OAHL,EAIKwB,KAJL,CAIYX,CAAD,IAAOY,OAAO,CAACC,GAAR,CAAYb,CAAZ,CAJlB;AAKH;AACJ,GATQ,EASN,EATM,CAAT,CAvBW,CAkCX;;AACA3C,EAAAA,KAAK,CAACC,SAAN,CAAgB,MAAM;AAClB,UAAMgD,KAAK,GAAGC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAd;;AACA,QAAIF,KAAJ,EAAW;AACPlC,MAAAA,OAAO,CAAC0C,WAAR,CAAoBR,KAApB,EACKI,IADL,CACWK,GAAD,IAAS;AACXlC,QAAAA,cAAc,CAAC;AACXmC,UAAAA,QAAQ,EAAED,GAAG,CAACE,IAAJ,CAASD,QADR;AAEXE,UAAAA,GAAG,EAAEH,GAAG,CAACE,IAAJ,CAASC;AAFH,SAAD,CAAd;AAIH,OANL,EAOKP,KAPL,CAOYX,CAAD,IAAOY,OAAO,CAACC,GAAR,CAAYb,CAAZ,CAPlB;AAQH;AACJ,GAZD,EAYG,EAZH,EAnCW,CAiDX;;AACA,WAASmB,cAAT,GAA0B;AACtBxB,IAAAA,mBAAmB,CAAC,KAAD,CAAnB;AACAN,IAAAA,eAAe,CAAC,KAAD,CAAf;AACAN,IAAAA,WAAW,CAAC,IAAD,CAAX;AACAe,IAAAA,OAAO,CAACsB,IAAR,CAAa,SAAb;AACH;;AAED,WAASC,kBAAT,GAA8B;AAC1BtC,IAAAA,WAAW,CAAC,KAAD,CAAX;AACAM,IAAAA,eAAe,CAAC,IAAD,CAAf;AACH;;AAED,WAASiC,mBAAT,GAA+B;AAC3B/B,IAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACH;;AAED,WAASW,cAAT,GAA0B;AACtBP,IAAAA,mBAAmB,CAAC,KAAD,CAAnB;AACAN,IAAAA,eAAe,CAAC,KAAD,CAAf;AACAN,IAAAA,WAAW,CAAC,KAAD,CAAX;AACAe,IAAAA,OAAO,CAACsB,IAAR,CAAa,GAAb;AACH;;AAED,WAASG,cAAT,GAA0B;AACtBhC,IAAAA,gBAAgB,CAAC,KAAD,CAAhB;AACH,GA3EU,CA6EX;;;AACA,WAASiC,UAAT,CAAoBC,KAApB,EAA2BC,QAA3B,EAAqC;AACjCtD,IAAAA,OAAO,CAACuD,aAAR,CAAsBF,KAAtB,EAA6BC,QAA7B,EACKhB,IADL,CACWK,GAAD,IAAS;AACXb,MAAAA,cAAc;AACdf,MAAAA,WAAW,CAAC,IAAD,CAAX;AACAN,MAAAA,cAAc,CAAC;AAAEmC,QAAAA,QAAQ,EAAED,GAAG,CAACE;AAAhB,OAAD,CAAd;AACAnB,MAAAA,OAAO,CAACsB,IAAR,CAAa,aAAb;AACH,KANL,EAOKT,KAPL,CAOYX,CAAD,IAAO;AAAEY,MAAAA,OAAO,CAACC,GAAR,CAAYb,CAAZ;AAAgB,KAPpC;AAQH;;AAED,WAAS4B,cAAT,CAAwBH,KAAxB,EAA+BC,QAA/B,EAAyCV,QAAzC,EAAmD;AAC/C5C,IAAAA,OAAO,CAACyD,YAAR,CAAqBJ,KAArB,EAA4BC,QAA5B,EAAsCV,QAAtC,EACKN,IADL,CACU,MAAM;AACRrB,MAAAA,eAAe,CAAC,KAAD,CAAf;AACAM,MAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACH,KAJL,EAKKgB,KALL,CAKYX,CAAD,IACHY,OAAO,CAACC,GAAR,CAAYb,CAAZ,CANR;AAOH,GAjGU,CAmGX;;;AACA,WAAS8B,WAAT,CAAqBC,MAArB,EAA6B;AACzBlC,IAAAA,kBAAkB,CAAC,IAAD,CAAlB;AACAJ,IAAAA,qBAAqB,CAAC,KAAD,CAArB;AACAlB,IAAAA,QAAQ,CAAC,EAAD,CAAR;AAEAJ,IAAAA,OAAO,CAAC6D,YAAR,CAAqBD,MAArB,EACKrB,IADL,CACWK,GAAD,IAAS;AACX,UAAIA,GAAG,CAACkB,YAAJ,KAAqB,CAAzB,EAA4B;AACxBxC,QAAAA,qBAAqB,CAAC,IAAD,CAArB;AACH,OAFD,MAEO;AAAElB,QAAAA,QAAQ,CAACwC,GAAD,CAAR;AAAe;AAC3B,KALL,EAMKL,IANL,CAMU,MAAM;AACRb,MAAAA,kBAAkB,CAAC,KAAD,CAAlB;AACH,KARL,EASKc,KATL,CASYX,CAAD,IAAOY,OAAO,CAACC,GAAR,CAAYb,CAAZ,CATlB;AAUH,GAnHU,CAqHX;;;AACA,WAASkC,iBAAT,CAA2BC,IAA3B,EAAiC;AAC7B,UAAMC,EAAE,GAAGD,IAAI,CAACE,GAAhB;AAEAjE,IAAAA,OAAO,CAACkE,WAAR,CAAoBF,EAApB,EACK1B,IADL,CACWK,GAAD,IAAS;AACXtC,MAAAA,YAAY,CAACG,WAAW,CAACsC,GAAb,CAAZ;AACAjC,MAAAA,YAAY,CAAC,IAAD,CAAZ;AACH,KAJL,EAKK0B,KALL,CAKYX,CAAD,IAAOY,OAAO,CAACC,GAAR,CAAYb,CAAZ,CALlB;AAMH,GA/HU,CAiIX;;;AACA1C,EAAAA,SAAS,CAAC,MAAM;AACZc,IAAAA,OAAO,CAACmE,gBAAR,CAAyB3D,WAAW,CAACsC,GAArC,EACKR,IADL,CACWK,GAAD,IAAS;AACXpC,MAAAA,aAAa,CAACoC,GAAD,CAAb;AACH,KAHL;AAIH,GALQ,EAKN,CAAC/B,WAAD,EAAcE,UAAd,CALM,CAAT,CAlIW,CAyIX;;AACA,WAASsD,aAAT,GAAyB;AACrBjC,IAAAA,YAAY,CAACkC,UAAb,CAAwB,OAAxB;AACA5D,IAAAA,cAAc,CAAC,EAAD,CAAd;AACAM,IAAAA,WAAW,CAAC,KAAD,CAAX;AACAW,IAAAA,OAAO,CAACsB,IAAR,CAAa,GAAb;AACH;;AAED,sBACI;AAAA,2BACI,QAAC,kBAAD,CAAoB,QAApB;AAA6B,MAAA,KAAK,EAAExC,WAApC;AAAA,6BACI;AAAK,QAAA,SAAS,EAAC,KAAf;AAAA,gCACI,QAAC,MAAD;AAAA,kCACI,QAAC,KAAD;AAAO,YAAA,KAAK,MAAZ;AAAa,YAAA,IAAI,EAAC,aAAlB;AAAA,mCACI,QAAC,SAAD;AACI,cAAA,UAAU,EAAEM,UADhB;AAEI,cAAA,eAAe,EAAEI,eAFrB;AAGI,cAAA,aAAa,EAAEkD,aAHnB;AAII,cAAA,OAAO,EAAEjB,cAJb;AAKI,cAAA,MAAM,EAAED,mBALZ;AAMI,cAAA,IAAI,EAAC,YANT;AAOI,cAAA,UAAU,EAAE5C;AAPhB;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,kBADJ,eAYI,QAAC,KAAD;AAAO,YAAA,IAAI,EAAC,GAAZ;AAAA,oCACI,QAAC,MAAD;AACI,cAAA,cAAc,EAAE6C,cADpB;AAEI,cAAA,UAAU,EAAErC,UAFhB;AAGI,cAAA,eAAe,EAAEI,eAHrB;AAII,cAAA,kBAAkB,EAAE+B,kBAJxB;AAKI,cAAA,aAAa,EAAEmB,aALnB;AAMI,cAAA,MAAM,EAAErB,cANZ;AAOI,cAAA,OAAO,EAAEjB,cAPb;AAQI,cAAA,MAAM,EAAEoB,mBARZ;AASI,cAAA,IAAI,EAAC;AATT;AAAA;AAAA;AAAA;AAAA,oBADJ,eAYI,QAAC,IAAD;AACI,cAAA,KAAK,EAAEhD,KAAK,CAACoE,QADjB;AAEI,cAAA,SAAS,EAAElE,SAFf;AAGI,cAAA,UAAU,EAAEU,UAHhB;AAII,cAAA,kBAAkB,EAAEM,kBAJxB;AAKI,cAAA,eAAe,EAAEI,eALrB;AAMI,cAAA,OAAO,EAAEZ,WANb;AAOI,cAAA,MAAM,EAAEkD,iBAPZ;AAQI,cAAA,WAAW,EAAEJ,WARjB;AASI,cAAA,IAAI,EAAC;AATT;AAAA;AAAA;AAAA;AAAA,oBAZJ;AAAA;AAAA;AAAA;AAAA;AAAA,kBAZJ;AAAA;AAAA;AAAA;AAAA;AAAA,gBADJ,eAuCI,QAAC,KAAD;AAAO,UAAA,IAAI,EAAC,SAAZ;AAAA,iCACI,QAAC,cAAD;AACI,YAAA,YAAY,EAAC,SADjB;AAEI,YAAA,WAAW,EAAC,SAFhB;AAGI,YAAA,WAAW,EAAET,kBAHjB;AAII,YAAA,MAAM,EAAEvC,UAJZ;AAKI,YAAA,UAAU,EAAE0C,UALhB;AAMI,YAAA,OAAO,EAAEtB;AANb;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,gBAvCJ,eAiDI,QAAC,KAAD;AAAO,UAAA,IAAI,EAAC,SAAZ;AAAA,iCACI,QAAC,QAAD;AACI,YAAA,YAAY,EAAC,SADjB;AAEI,YAAA,WAAW,EAAC,SAFhB;AAGI,YAAA,WAAW,EAAEiB,cAHjB;AAII,YAAA,MAAM,EAAE/B,cAJZ;AAKI,YAAA,UAAU,EAAEwC,cALhB;AAMI,YAAA,OAAO,EAAE1B;AANb;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,gBAjDJ,eA6DI,QAAC,YAAD;AACI,UAAA,MAAM,EAAER,kBADZ;AAEI,UAAA,QAAQ,EAAEyB,cAFd;AAGI,UAAA,OAAO,EAAEjB;AAHb;AAAA;AAAA;AAAA;AAAA,gBA7DJ,eAkEI,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,gBAlEJ;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA;AADJ,mBADJ;AA0EH;;GA3NQ7B,G;UAaWX,U;;;KAbXW,G;AA6NT,eAAeA,GAAf","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Route, Switch, useHistory } from 'react-router-dom';\n\nimport Authentication from '../Authentication/Authentication.js';\nimport { CurrentUserContext } from '../../contexts/CurrentUserContext.js';\nimport Header from '../Header/Header.js';\nimport Footer from '../Footer/Footer.js';\nimport Main from '../Main/Main.js';\nimport Register from '../Register/Register.js';\nimport SavedNews from '../SavedNews/SavedNews.js';\nimport SuccessPopup from '../SuccessPopup/SuccessPopup.js';\nimport newsApi from '../../utils/NewsApi.js';\nimport mainApi from '../../utils/MainApi.js';\n\n\nfunction App() {\n    const [cards, setCards] = useState([]);\n    const [cardOwner, setCardOwner] = useState({});\n    const [savedCards, setSavedCards] = useState([]);\n    const [currentUser, setCurrentUser] = useState({});\n    const [isAuthOpen, setAuthOpen] = useState(false);\n    const [isCardSaved, setCardSaved] = useState(false);\n    const [isLoggedIn, setLoggedIn] = useState(false);\n    const [isRegisterOpen, setRegisterOpen] = useState(false);\n    const [isNavMobileOpen, setNavMobileOpen] = useState(false);\n    const [isNothingFoundOpen, setIsNothingFoundOpen] = useState(false);\n    const [isSuccessPopupOpen, setSuccessPopupOpen] = useState(false);\n    const [isPreloaderOpen, setIsPreloaderOpen] = useState(false);\n    const history = useHistory();\n\n    // global state for close on Esc\n    useEffect(() => {\n        const close = (e) => { if (e.keyCode === 27) { closeAllPopups(); } }\n        window.addEventListener('keydown', close)\n        return () => window.removeEventListener('keydown', close)\n    })\n\n    // checking token\n    useEffect(() => {\n        const token = localStorage.getItem('token');\n        if (token) {\n            mainApi.getContent(token)\n                .then(() => {\n                    setLoggedIn(true);\n                })\n                .catch((e) => console.log(e))\n        }\n    }, [])\n\n    // getting user info\n    React.useEffect(() => {\n        const token = localStorage.getItem('token');\n        if (token) {\n            mainApi.getUserInfo(token)\n                .then((res) => {\n                    setCurrentUser({\n                        username: res.user.username,\n                        _id: res.user._id\n                    })\n                })\n                .catch((e) => console.log(e))\n        }\n    }, [])\n\n    // popup behaviour\n    function handleAuthOpen() {\n        setSuccessPopupOpen(false);\n        setRegisterOpen(false);\n        setAuthOpen(true);\n        history.push('/signin');\n    }\n\n    function handleRegisterOpen() {\n        setAuthOpen(false);\n        setRegisterOpen(true);\n    }\n\n    function handleNavMobileOpen() {\n        setNavMobileOpen(true);\n    }\n\n    function closeAllPopups() {\n        setSuccessPopupOpen(false);\n        setRegisterOpen(false);\n        setAuthOpen(false);\n        history.push('/');\n    }\n\n    function closeNavMobile() {\n        setNavMobileOpen(false);\n    }\n\n    // user forms submit\n    function handleAuth(email, password) {\n        mainApi.authorizeUser(email, password)\n            .then((res) => {\n                closeAllPopups();\n                setLoggedIn(true);\n                setCurrentUser({ username: res.user })\n                history.push('/saved-news');\n            })\n            .catch((e) => { console.log(e) });\n    }\n\n    function handleRegister(email, password, username) {\n        mainApi.registerUser(email, password, username)\n            .then(() => {\n                setRegisterOpen(false);\n                setSuccessPopupOpen(true);\n            })\n            .catch((e) =>\n                console.log(e));\n    }\n\n    // searching cards\n    function searchCards(search) {\n        setIsPreloaderOpen(true);\n        setIsNothingFoundOpen(false);\n        setCards([]);\n\n        newsApi.getCardsList(search)\n            .then((res) => {\n                if (res.totalResults === 0) {\n                    setIsNothingFoundOpen(true);\n                } else { setCards(res) }\n            })\n            .then(() => {\n                setIsPreloaderOpen(false)\n            })\n            .catch((e) => console.log(e));\n    }\n\n    // saving an article \n    function handleSaveArticle(card) {\n        const id = card.url;\n\n        mainApi.saveArticle(id)\n            .then((res) => {\n                setCardOwner(currentUser._id);\n                setCardSaved(true);\n            })\n            .catch((e) => console.log(e))\n    }\n\n    // load saved articles\n    useEffect(() => {\n        mainApi.getSavedArticles(currentUser._id)\n            .then((res) => {\n                setSavedCards(res);\n            })\n    }, [isCardSaved, isLoggedIn])\n\n    // logging out\n    function handleSignOut() {\n        localStorage.removeItem('token');\n        setCurrentUser({});\n        setLoggedIn(false);\n        history.push('/');\n    }\n\n    return (\n        <>\n            <CurrentUserContext.Provider value={currentUser}>\n                <div className='app'>\n                    <Switch>\n                        <Route exact path='/saved-news'>\n                            <SavedNews\n                                isLoggedIn={isLoggedIn}\n                                isNavMobileOpen={isNavMobileOpen}\n                                handleSignOut={handleSignOut}\n                                onClose={closeNavMobile}\n                                onOpen={handleNavMobileOpen}\n                                page='saved-news'\n                                savedCards={savedCards}\n                            />\n                        </Route>\n                        <Route path='/'>\n                            <Header\n                                closeNavMobile={closeNavMobile}\n                                isLoggedIn={isLoggedIn}\n                                isNavMobileOpen={isNavMobileOpen}\n                                handleRegisterOpen={handleRegisterOpen}\n                                handleSignOut={handleSignOut}\n                                onAuth={handleAuthOpen}\n                                onClose={closeAllPopups}\n                                onOpen={handleNavMobileOpen}\n                                page='main'\n                            />\n                            <Main\n                                cards={cards.articles}\n                                cardOwner={cardOwner}\n                                isLoggedIn={isLoggedIn}\n                                isNothingFoundOpen={isNothingFoundOpen}\n                                isPreloaderOpen={isPreloaderOpen}\n                                isSaved={isCardSaved}\n                                onSave={handleSaveArticle}\n                                searchCards={searchCards}\n                                page='main'\n                            />\n                        </Route>\n                    </Switch>\n\n                    <Route path='/signin'>\n                        <Authentication\n                            altFormTitle='Sign up'\n                            altFormLink='/signup'\n                            openAltForm={handleRegisterOpen}\n                            isOpen={isAuthOpen}\n                            formSubmit={handleAuth}\n                            onClose={closeAllPopups}\n                        />\n                    </Route>\n                    <Route path='/signup'>\n                        <Register\n                            altFormTitle='Sign in'\n                            altFormLink='/signin'\n                            openAltForm={handleAuthOpen}\n                            isOpen={isRegisterOpen}\n                            formSubmit={handleRegister}\n                            onClose={closeAllPopups}\n\n                        />\n                    </Route>\n\n                    <SuccessPopup\n                        isOpen={isSuccessPopupOpen}\n                        openAuth={handleAuthOpen}\n                        onClose={closeAllPopups}\n                    />\n                    <Footer />\n                </div>\n            </CurrentUserContext.Provider>\n        </>\n    )\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}